<html>
       
    <title>Memofood</title>   

    <head>
        <!-- icon -->
        <link rel="icon" href = "Images/logo.ico">
           
        <!-- google font: IBM Sans Plex -->
        <link href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:200,300,400,500,600,700&display=swap" rel="stylesheet">
        
        <!-- stylesheet -->
        <link href="stylesheet.css" rel="stylesheet" type="text/css">
    </head>

    <body id="body" class="light-mode" onload="myFunction()">
        
        <div id="rain" class="rain"></div>
        <div id="loadertitle"><img src="Images/logo.png" style="width: 200; height: 200;"></div>
        
        <div style="display:none;" id="myDiv" class="animate-bottom">
        
            <!-- navbar -->
            <div class="topnav" style="width: 100%;">
              <!--<a class="active" href="#menu"><img src="logo.png" style="width: 15; height: 20px;"></a>-->
              <a href="home.html"><img src="Images/logo.png" style="width: 22; height: 22;" style="float: left;"></a> 

                <a href="home.html" class="dropbtn" style="float: left;">Home</a>

                <a href="memo.html" class="dropbtn" style="float: left;">Your Memo</a>

                <a href="points.html" class="dropbtn" style="float: left;">Your Points</a>
                
                <a href="about.html" class="dropbtn" style="float: left;">About Us</a>

                <a href="faq.html" class="dropbtn" style="border-bottom: 5px solid #90EE90; float: left;">FAQ</a>
                
                <!--<a href="account.html" target="_blank" style="float: right; cursor: pointer;"><img id="myphoto" src="Images/user.png" style="width: 35; height: 35px;"></a>-->

                <div class="dropdown" style="float: right;">
                  <button onclick="myFunction()" class="dropbtn"><img id="myphoto" src="Images/user.png" style="width: 35; height: 35px;"></button>
                    <div id="myDropdown" class="dropdown-content" style="position: fixed; left: 80%; top: 11.5%; width: 300px; text-align: center;">
                        <h1 style="color: #000; font-family: IBM Plex Sans; font-weight: bolder;" id="namediv">Guest</h1>
                        <a style="color: #90EE90; text-align: center;" id="myemail">guest1@gmail.com</a>
                        <a id="mylevel" style="text-align: center;">Level: Beginner</a>
                        <a id="mydroplets" style="text-align: center;">Points: 0</a>
                        <p><button onclick="login()" style="float: left; margin-left: 50px; width: 70px; height: 40px; cursor: pointer; background: #90EE90; color: #fff; font-family: IBM Plex Sans; font-size: 15px;">Log In</button></p>
                        <p><button onclick="logout()" style="float: right; margin-right: 50px; margin-bottom: 10px; width: 70px; height: 40px; cursor: pointer; background: #90EE90; color: #fff; font-family: IBM Plex Sans; font-size: 15px;">Log Out</button></p>
                    </div>
                </div>
                
                <!-- Dark/light toggle -->
                <a name="dark_light" onclick="toggleDarkLight()" title="Toggle dark/light mode" style="float: right;"><img src="Images/sun.png" width="25" height="25"></a>

            </div>


            <div id="board"></div>
        
                
        <!-- Background -->
        <img src="Images/background5.png" style="width: 100%;">
            
        <div style="height: 40%;">
                <p style="text-align: center; margin-top: 100px; font-family: IBM Plex Sans; font-weight: 300; font-size: 30px; line-height: 1;">Why'd you make <span style="color: #7CFC00">this </span><span style="color: #006400">app?</span></p>
                <p style="margin-top: 50px; font-family: IBM Plex Sans; font-weight: 200; font-size: 17px; text-align: center; text-align-last: center; line-height: 1.8; margin-left: 175; margin-right: 175;">We made the Memofood app because we want to bridge the gap between people and their products, make a difference and reduce food waste in Canada.</p><br><br>
        </div>
            
        <div style="background-color: lightgray; height: 70%;">
                <br><p style="text-align: center; margin-top: 100px; font-family: IBM Plex Sans; font-weight: 300; font-size: 30px; line-height: 1;">How does your <span style="color: #7CFC00">app </span><span style="color: #006400">work?</span></p>
                <p style="margin-top: 50px; font-family: IBM Plex Sans; font-weight: 200; font-size: 17px; text-align: justify; text-align-last: center; line-height: 1.8; float: right; margin-left: 175; margin-right: 175;">We  partner with supermarkets using a simple step-by-step solution where food items that are scanned by cashiers will be automatically synced to your Memofood account, providing you with information about the productâ€™s name, date and location of production, nutrition facts, its disposal procedure and most importantly its expiration date. This way, when food items approach its expiry date, you will be reminded through the Memofood application using notifications to consume the product.</p>
        </div>
            
        <div style="height: 70%;">
                <br><p style="text-align: center; margin-top: 100px; font-family: IBM Plex Sans; font-weight: 300; font-size: 30px; line-height: 1;">Why <span style="color: #7CFC00">Memo</span><span style="color: #006400">food?</span></p>
                <p style="margin-top: 50px; font-family: IBM Plex Sans; font-weight: 200; font-size: 17px; text-align: justify; text-align-last: center; line-height: 1.8; float: right; margin-left: 175; margin-right: 175;">First of all, our app is user friendly. With simply a click of a few buttons, you will find that Memofood is extremely straightforward and easy to navigate. Secondly, Memofood reminds you what you already have at home, preventing you to buy excess food. Thirdly, our application takes a holistic approach at tackling food waste.
            We understand that while many people are environmentally conscious, studies show that when people have the choice between saving the environment and saving money, most will choose the latter. We are redefining what helping the environment means. With this app, you can save both money and the environment. </p>
        </div>
            
        <!-- Follow + Copyright -->
        <div style="background-color: #023400; height: 20%;"><br style="margin: 100 0;">
                <!-- Title + Buttons -->
                <p style="text-align: center; font-family: IBM Plex Sans; font-weight: 300; font-size: 30px; color: white; line-height: 1;">FOLLOW <span style="color: #7CFC00">US </span><a href="https://www.linkedin.com/company/memofood/about/" target="_blank"><img src="Images/linkedin.png" style="width: 50; height: 50;" hspace="20;"></a><a href="https://www.instagram.com/memofoodcanada" target="_blank"><img src="Images/instagram.png" style="width: 50; height: 50;"></a></p><br><br>
                
                <p style="color: white;">Copyright &copy; 2019 <span style="font-weight: 700">MEMOFOOD</span>. All Rights Reserved.</p>
        </div>     

    
    <div id="mytweets"></div>
    <div id="mydata"></div>
    <div id="myphoto"></div>
    </div>
     
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.9.4/firebase.js"></script>
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <script>
        /***** TRANSITIONING TOPNAV COLOR *****/
        window.onscroll = function() {scrollFunction()};  
            
        function scrollFunction() {
          if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
            document.getElementsByClassName('topnav')[0].style.backgroundColor = "#035300";
            document.getElementsByClassName('topnav')[0].style.boxShadow = "0px 8px 16px 0px rgba(0,0,0,0.2)";
          } else {
            document.getElementsByClassName('topnav')[0].style.backgroundColor = "transparent";
            document.getElementsByClassName('topnav')[0].style.boxShadow = "";
          }
        }
    
        //Loader code
        var myVar;
        var nbDrop = 800;
   
           function randRange(maxNum, minNum) {
            return (Math.floor(Math.random(10) * (maxNum - minNum + 1)) + minNum);
           }

           function createRain() {
            for (i = 0; i < nbDrop; i++) {

             var dropLeft = randRange(0, 3000);
             var dropTop = randRange(-1000, 1000);
             $('.rain').append('<div class="drop" id="drop'+ i +'"></div>');
             $('#drop' + i).css('left', dropLeft);
             $('#drop' + i).css('top', dropTop); 
            }
           }
        
        function toggleDarkLight() {
          var body = document.getElementById("body");
          var currentClass = body.className;
          body.className = currentClass == "dark-mode" ? "light-mode" : "dark-mode";
        }

        function stuff() {
          myVar = setTimeout(showPage, 3000);
        }
        
        function myFunction() {
            createRain();
            stuff();
        }

        function showPage() {
          document.getElementById("rain").style.display = "none";
          document.getElementById("loadertitle").style.display = "none";
          document.getElementById("myDiv").style.display = "block";
        }  
        
    // Initialize Firebase
    var loadDate = "";
    var droplets = 0;
        
    var config = {
        apiKey: "AIzaSyBVOwlTeu_-jnXZp253XbfQEFi7a60rVKE",
        authDomain: "droplet-34330.firebaseapp.com",
        databaseURL: "https://droplet-34330.firebaseio.com",
        projectId: "droplet-34330",
        storageBucket: "droplet-34330.appspot.com",
        messagingSenderId: "822727269402"
      };
      firebase.initializeApp(config);
                
        // Check to see if you are logged in
        firebase.auth().onAuthStateChanged(function(user) {
            if (user == null) {
                //alert("Not logged in.");
                return;
            } else {
                userId = user.uid;
                name = user.displayName;
                imageUrl = user.photoURL;
                email = user.email;
                
                loadDate = new Date().toString();
                    
                // write user data to users
                //writeUserData(userId, name, email, imageUrl);
                // moved to tweet function
                
                // write data to document
                mydiv = document.getElementById("mydata");
                document.getElementById("namediv").innerHTML = name;
                
                myemaildiv = document.getElementById("myemail");
                document.getElementById("myemail").innerHTML = email;
                
                myphotodiv = document.getElementById("myphoto");
                myphotodiv.innerHTML = "<img src='" + imageUrl + "' style='position:absolute; left: 1300px; top: 72px; width: 75px; height: 75px;'/>";
                
                mydropdiv = document.getElementById("mydroplets");
                document.getElementById("mydroplets").innerHTML = "Droplets: " + droplets;

                firebase.database().ref('/tweets').once('value').then(function(snapshot) {
                    var data = (snapshot.val());
                    if (data == null) {
                      console.log("No data found at /tweets/" + userId);  
                    } else {
                        
                      firebase.database().ref('/users').once('value').then(function(snapshot) { 
                        var userdata = (snapshot.val());
                        if (userdata != null) {
                           dataarray = [data,userdata]
                           console.log(dataarray)
                           updatetweets(dataarray); 
                        }
                      });
                      //console.log(data)
                      //updatetweets(data);
                    }
                });
            } // end user null check
        }); // end check auth state
        
        function encodeImageFileAsURL() {

            var filesSelected = document.getElementById("inputFileToLoad").files;
            if (filesSelected.length > 0) {
                var fileToLoad = filesSelected[0];
                var fileReader = new FileReader();
                fileReader.onload = function(fileLoadedEvent) {
                    var srcData = fileLoadedEvent.target.result; // <--- data: base64
                    //var newImage = document.createElement('img');
                    //newImage.src = srcData;
                    //document.getElementById("imgTest").innerHTML = newImage.outerHTML;
                    document.getElementById("imgTest").innerHTML = srcData;
                    //console.log("Converted Base64 version is: " + document.getElementById("imgTest").innerHTML);
                    console.log(srcData);
                }
                fileReader.readAsDataURL(fileToLoad);
            }
        } // end function
        
        // write user data
        function writeUserData(userId, name, email, imageUrl) {
            firebase.database().ref('users/' + userId).once('value',    function(snapshot) {
                 if (!snapshot.exists()) {
                    firebase.database().ref('users/' + userId).set({
                        username: name,
                        email: email,
                        profile_picture : imageUrl,
                       
                    }); 
                 }                                      
            });
        }
        
        function updatetweets(data) {
            //var mylist = "<ul>";
            var mytab = "<br><br><br><table>";
            users = data[1]; // put on top, because changed data - not good coding change later
            data = data[0];
            
            for (var u in data) {
                for (var t in data[u]) {
                    mytab = mytab + "<tr>";
                    //var date = timeSince(new Date(Date.now()));
                    var date = new Date(data[u][t].time);
                    var time = date.toString();
                    if (time.substring(0,15) == loadDate.substring(0,15)) {
                        if (time.substring(16,18) == loadDate.substring(16,18)) {
                            var num1 = Number(loadDate.substring(19,21));
                            var num2 = Number(time.substring(19,21));
                            console.log(num1);
                            var num3 = num1 - num2;
                            time = num3.toString() + " minutes ago";
                        } else {
                            var num1 = Number(loadDate.substring(16,18));
                            var num2 = Number(time.substring(16,18));
                            var num3 = num1 - num2;
                            if (num3 == 1) {
                                var num1 = Number(loadDate.substring(19,21));
                                var num2 = Number(time.substring(19,21));
                                console.log(num1);
                                var num3 = num1 - num2 + 60;
                                if (num3 > 59) {
                                    time = "1 hour ago"
                                } else {
                                    time = num3.toString() + " minutes ago";
                                }
                            } else {
                                time = num3.toString() + " hours ago";
                            }
                        }
                    } else {
                        time = time.substring(4,15);
                    }
                    //If there is an image posted
                    if (data[u][t].img != "") {
                        mytab = mytab + "<td><img src='" + users[u].profile_picture + "' width='50px'></td>";
                        mytab = mytab + "<td>" + users[u].username + "</td>";
                        mytab = mytab + "<td>" + data[u][t].tweet + "</td>";
                        mytab = mytab + "<td>" + time + "<br><img src='" + data[u][t].img + "' width='300px'></td>";
                    } else {
                        mytab = mytab + "<td><img src='" + users[u].profile_picture + "' width='50px'></td>";
                        mytab = mytab + "<td>" + users[u].username + "</td>";
                        mytab = mytab + "<td>" + data[u][t].tweet + "</td>";
                        mytab = mytab + "<td>" + time + "</td>";
                        
                        
                    } 
                    mytab = mytab + "</tr>";
                }   
            }
            //mylist = mylist + "</ul>";
            mytab = mytab + "</table>"
            var mytdiv = document.getElementById("mytweets");
            //mytdiv.innerHTML = mylist;
            mytdiv.innerHTML = mytab;
        }
        
        // write tweets to firebase
        function tweet() {
            
            //4-0
            
            loadDate = new Date().toString();
            var twitdoc = document.getElementById("twit");
            var twitimg = document.getElementById("imgTest");
            var nameValue = twitdoc.value;
            var imgValue = twitimg.innerHTML;
            var js_time = Date.now();
            var tweetid = firebase.database().ref('tweets/' + userId + "/").push({tweet: nameValue, time: js_time, img: imgValue});
            twitdoc.value = "";
            writeUserData(userId, name, email, imageUrl);
            console.log("tweet written")
            
            firebase.database().ref('/tweets').once('value').then(function(snapshot) {
                    var data = (snapshot.val());
                    if (data == null) {
                      console.log("No data found at /tweets/" + userId);  
                    } else { 
                        firebase.database().ref('/users').once('value').then(function(snapshot) { 
                        var userdata = (snapshot.val());
                        if (userdata != null) {
                           dataarray = [data,userdata]
                           console.log(dataarray)
                           updatetweets(dataarray); 
                        }
                      });
                    }
                });
            
            
            
            // The unique key stored in tweetid is based on a timestamp, so list items will automatically be ordered chronologically. Because Firebase generates a unique key for each tweet, no write conflicts will occur if multiple users add a post at the same time. https://firebase.google.com/docs/database/admin/save-data
            
        }
        
        var timeSince = function(date) {
            
            //4-0
          switch (typeof time) {
            case 'number':
              break;
            case 'string':
              time = +new Date(time);
              break;
            case 'object':
              if (time.constructor === Date) time = time.getTime();
              break;
            default:
              time = +new Date();
          }
          var time_formats = [
            [60, 'seconds', 1], // 60
            [120, '1 minute ago', '1 minute from now'], // 60*2
            [3600, 'minutes', 60], // 60*60, 60
            [7200, '1 hour ago', '1 hour from now'], // 60*60*2
            [86400, 'hours', 3600], // 60*60*24, 60*60
            [172800, 'Yesterday', 'Tomorrow'], // 60*60*24*2
            [604800, 'days', 86400], // 60*60*24*7, 60*60*24
            [1209600, 'Last week', 'Next week'], // 60*60*24*7*4*2
            [2419200, 'weeks', 604800], // 60*60*24*7*4, 60*60*24*7
            [4838400, 'Last month', 'Next month'], // 60*60*24*7*4*2
            [29030400, 'months', 2419200], // 60*60*24*7*4*12, 60*60*24*7*4
            [58060800, 'Last year', 'Next year'], // 60*60*24*7*4*12*2
            [2903040000, 'years', 29030400], // 60*60*24*7*4*12*100, 60*60*24*7*4*12
            [5806080000, 'Last century', 'Next century'], // 60*60*24*7*4*12*100*2
            [58060800000, 'centuries', 2903040000] // 60*60*24*7*4*12*100*20, 60*60*24*7*4*12*100
          ];
          var seconds = (+new Date() - time) / 1000,
            token = 'ago',
            list_choice = 1;

          if (seconds == 0) {
            return 'Just now'
          }
          if (seconds < 0) {
            seconds = Math.abs(seconds);
            token = 'from now';
            list_choice = 2;
          }
          var i = 0,
            format;
          while (format = time_formats[i++])
            if (seconds < format[0]) {
              if (typeof format[2] == 'string')
                return format[list_choice];
              else
                return Math.floor(seconds / format[2]) + ' ' + format[1] + ' ' + token;
            }
          return time;
        };
        
        
        
        function login() {
            console.log("Logging in");
            var provider = new firebase.auth.GoogleAuthProvider();
            firebase.auth().signInWithRedirect(provider).then(function(result) { 
                window.location.replace("home.html");
            });
        }
        
        function logout() {
            console.log("Logging out");
            firebase.auth().signOut().then(function() {
            });
        }
        
        function changename() {
            console.log("Changing username");
            //name = username;
        }
        
        function like() {
            //barca lost
            alert("You liked Bob's Article! :)");
            droplets = droplets + 5;
            mydropdiv = document.getElementById("mydroplets");
            document.getElementById("mydroplets").innerHTML = "Droplets: " + droplets;
            
        }
    
        function dislike() {
            alert("You disliked Bob's Article :(");
            droplets = droplets - 1;
            mydropdiv = document.getElementById("mydroplets");
            document.getElementById("mydroplets").innerHTML = "Droplets: " + droplets;
        }
        
    </script>

        
    </body>
 
</html>